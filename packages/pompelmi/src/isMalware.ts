import type { Readable } from 'node:stream';
import { scan, type ScanOptions, type ScanReport } from './scan.js';

/**
 * Convenience helper â€“ returns **true** if the given input is determined to be
 * malware. Internally calls {@link scan} and collapses the full `ScanReport`
 * into a simple boolean verdict so that developers can perform a quick
 * allow/deny check in one line.
 *
 * @example
 *   if (await isMalware(fileBuffer)) throw new Error('Blocked: malware');
 */
export async function isMalware(
  input: Buffer | Readable | string,
  opts: ScanOptions = {},
): Promise<boolean> {
  const report: ScanReport = await scan(input, opts);
  // Treat only the strongest verdict as malware; callers who need to act on
  // `suspicious` can still use the full `scan()` API.
  return report.verdict === 'malicious';
}